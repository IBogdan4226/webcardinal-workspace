import{r as t,c as a,h as n,H as e}from"./p-d4191909.js";import"./p-8fa78097.js";import{d as i,F as o,l as r,m as s,q as l,p as c}from"./p-856e6638.js";import{H as d}from"./p-813bc48c.js";import{C as h}from"./p-173c2a35.js";import{p}from"./p-f8a2682a.js";import"./p-e506992e.js";import{i as b,a as u,B as f}from"./p-62c01f8b.js";const g=class{constructor(e){t(this,e),this.getModelEvent=a(this,"webcardinal:model:get",7),this.pageSize=20,this.pageSizeDelta=2,this.curentPageIndex=0,this.hidePagination=!1,this.templateChildrenCount=0,this.childrenCount=0,this.getTemplatesFromDOM=()=>{const t={header:[],data:[]},a=Object.keys(t);for(const n of Array.from(this.host.childNodes))if(b(n))t.data.push(n);else if(u(n)){const e=n;if(!e.hasAttribute("slot")){t.data.push(e),this.childrenCount++;continue}if(a.includes(e.slot)){const{slot:a}=e;e.removeAttribute("slot"),e.classList.add("webc-datatable--"+a),t[a].push(e),this.childrenCount++}}return t},this.getDataSourceFromModel=async()=>{let{chain:t}=this;return t.startsWith(i)&&(t=t.substring(1)),(await p(this.getModelEvent)).getChainValue(t)},this.renderPagination=()=>{const t=this.curentPageIndex+1,a=this.dataSize?Math.ceil(this.dataSize/this.pageSize):1,e=[],i=function(t,a,n=2){const e=[],i=[];if(a<=1)return e;e.push(1);for(let i=t-n;i<=t+n;i++)i<a&&i>1&&e.push(i);let o;e.push(a);for(let t of e)o&&(t-o==2?i.push(o+1):t-o!=1&&i.push("...")),i.push(t),o=t;return i}(t,a,this.pageSizeDelta);for(const a of i)if("number"!=typeof a)"string"==typeof a&&e.push(a);else{if(a===t){e.push(n("button",{active:!0,part:"pagination-button pagination-button--active",disabled:!0},a));continue}e.push(n("button",{part:"pagination-button",onClick:()=>this.dataSource.goToPageByIndex(a-1)},a))}return 1!==a&&(e.unshift(n("button",{part:"pagination-button pagination-button--previous",disabled:1===t,onClick:()=>this.dataSource.goToPreviousPage()},"‹")),e.push(n("button",{part:"pagination-button pagination-button--next",disabled:t===a,onClick:()=>this.dataSource.goToNextPage()},"›"))),e}}async componentWillLoad(){if(!this.host.isConnected)return;this.dataSource=await this.getDataSourceFromModel();const{DataSource:t}=window.WebCardinal.dataSources;if(!(this.dataSource&&"object"==typeof this.dataSource&&this.dataSource instanceof t))return void console.error(`An invalid WebCardinal DataSource instance received: "${this.chain}"! [1]`,this.dataSource);try{this.model=await this.dataSource._init((()=>this.host))}catch(t){return console.error(`An invalid WebCardinal DataSource instance received: "${this.chain}"! [2]`,this.dataSource),void(this.dataSource=void 0)}const{header:a,data:n}=this.getTemplatesFromDOM();this.host.classList.add("webc-datatable");const e=document.createElement("style");e.innerHTML='\n[data-sortable] {\n    --header-arrow-size: 0.25rem;\n    --header-arrow-color: #BBBBBB;\n\n    cursor: pointer;\n    position: relative;\n    padding-right: calc(5 * var(--header-arrow-size));\n}\n\n[data-sortable]::before,\n[data-sortable]::after {\n    content: "";\n    height: 0;\n    width: 0;\n    position: absolute;\n    right: 4px;\n    border-left: var(--header-arrow-size) solid transparent;\n    border-right: var(--header-arrow-size) solid transparent;\n    opacity: 1;\n}\n\n[data-sortable]::before {\n    border-bottom: var(--header-arrow-size) solid var(--header-arrow-color);\n    border-top: var(--header-arrow-size) solid transparent;\n    bottom: 55%;\n}\n\n[data-sortable]::after {\n    border-top: var(--header-arrow-size) solid var(--header-arrow-color);\n    top: 55%;\n}\n';const d=document.createElement("div");d.setAttribute("slot","data"),d.classList.add("webc-datatable--container"),d.setAttribute("data-for-children-count",""+this.childrenCount),d.setAttribute(o,i+"data"),d.setAttribute(r,""+s),d.append(...n),d.addEventListener(l,(t=>{t.stopImmediatePropagation(),d.prepend(...a)})),d.addEventListener(c,(t=>{t.stopImmediatePropagation()})),this.host.append(e,d),f.bindChildNodes(this.host,{model:this.model,translationModel:{},recursive:!0,enableTranslations:!1}),this.listeners=new h(this.host,{model:this.model,translationModel:{},chain:i+"data"}),this.listeners.getModel.add(),this.listeners.getTranslationModel.add(),this.listeners.getParentChain.add(),d.prepend(...a),this.dataSource._renderPageAsync()}async connectedCallback(){if(this.listeners){const{getModel:t,getTranslationModel:a,getParentChain:n}=this.listeners;null==t||t.add(),null==a||a.add(),null==n||n.add()}}async disconnectedCallback(){if(this.listeners){const{getModel:t,getTranslationModel:a,getParentChain:n}=this.listeners;null==t||t.remove(),null==a||a.remove(),null==n||n.remove()}}async fillCurrentPage(t){var a;const n=t=>this.host.shadowRoot.querySelector(`slot[name="${t}"]`),e=t=>{n("before").insertAdjacentElement("afterend",(t=>Object.assign(document.createElement("slot"),{name:t}))(t))},i=n("data");if(!t||0===t.length)return null==i||i.remove(),n("no-data")||e("no-data"),this.hidePagination=!0,void(this.model.data=[]);i||(null===(a=n("no-data"))||void 0===a||a.remove(),e("data")),this.hidePagination=!1,this.model.data=t}async clearCurrentPage(){this.model.data.length=0}pageSizeHandler(){this.dataSource._renderPageAsync()}render(){return this.dataSource?n(e,null,n("slot",{name:"before"}),n("slot",{name:"data"}),this.hidePagination?null:n("div",{part:"pagination",class:"pagination"},this.renderPagination()),n("slot",{name:"footer"}),n("slot",{name:"after"})):null}static get watchers(){return{pageSize:["pageSizeHandler"]}}};(function(t,a,n,e){var i,o=arguments.length,r=o<3?a:null===e?e=Object.getOwnPropertyDescriptor(a,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,a,n,e);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(r=(o<3?i(r):o>3?i(a,n,r):i(a,n))||r);o>3&&r&&Object.defineProperty(a,n,r)})([d()],g.prototype,"host",void 0),g.style={default:":host .pagination{display:flex;gap:var(--pagination-gap);justify-content:center}:host .pagination>button{font-size:inherit;border:var(--pagination-button-border);background:var(--pagination-button-background)}:host .pagination>button:not([disabled]){cursor:pointer}:host .pagination>button[active]{color:inherit;font-weight:bold}"};export{g as webc_datatable}