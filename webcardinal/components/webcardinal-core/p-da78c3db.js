import{s as e,u as n,B as t,z as a,k as o,x as s,y as i,t as r,r as l,o as c,n as d,m as f}from"./p-5ba60a84.js";import{F as u,d as b,m as h,n as m,o as p,p as v,l as x,e as y,k as w,q as $,r as M,I as j,t as A,u as g,w as k,v as P,g as E,O,i as C,b as N,j as T,V,D as W,h as B}from"./p-bc85da7f.js";import{c as I,d as q}from"./p-e506992e.js";function z(n,t,a){const o=t.getChainValue(a);if(o){for(const[t,a]of Object.entries(o))e(n,{key:t,value:a});if(!0===o._saveElement){for(const e in n)"function"==typeof n[e]&&(n[e]=n[e].bind(n));o.getElement||t.setChainValue(a,Object.assign(Object.assign({},o),{getElement:()=>n}))}}if(t.hasExpression(a)){const o=t.evaluateExpression(a);for(const[t,a]of Object.entries(o))e(n,{key:t,value:a})}}function D(e){return e.nodeType===Node.ELEMENT_NODE}function F(e){return e.nodeType===Node.TEXT_NODE&&e.nodeValue&&e.nodeValue.trim()}function S(e,n){return D(e)&&e.getAttribute("slot")===n}function U(e,t,a,o=null){if(E.includes(e.nodeName.toLowerCase()))return;if(e.nodeType!==Node.TEXT_NODE||!e.nodeValue||!e.nodeValue.trim())return;const r=[...e.nodeValue.matchAll(/\{\{\s*([^\s}}]+)\s*\}\}/g)];if(!r.length)return;const l=r.map((e=>({expression:e[0],chainWithPrefix:e[1]}))).filter((({chainWithPrefix:e})=>e.startsWith(b)||e.startsWith(y))).map((e=>{let{chainWithPrefix:s}=e;const i=s.startsWith(y);let r=e.chainWithPrefix.slice(1);!i&&o&&(r=n(o,r),s=`${b}${r}`);const l=i?a:t;return Object.assign(Object.assign({},e),{chain:r,isTranslation:i,isModel:!i,isModelExpression:l.hasExpression(r),evaluateModelExpression:()=>l.evaluateExpression(r),model:l,getChainValue:()=>{let e=l.getChainValue(r);if(i&&void 0===e){const{pathname:n}=window.location,t=O();console.warn(`No translations found for skin "${t}", page "${n}" and chain "${r}"`),e=r}return e}})}));if(!l.length)return;const c=e.nodeValue,d=()=>{let n=c;l.forEach((({expression:e,getChainValue:t,isModelExpression:a,evaluateModelExpression:o})=>{let s=t();["number","boolean"].includes(typeof s)&&(s=s.toString()),!s&&a&&(s=a?o():""),n=n.replace(e,s||"")})),e.nodeValue=n};d(),l.filter((e=>e.isModel)).forEach((({model:n,chain:t,isModelExpression:a})=>{const o=()=>{d()};if(n.onChange(t,o),s(e,t,o),a){const a=()=>{d()};n.onChangeExpressionChain(t,a),i(e,t,a)}}))}const G={bindElement:(e,O={model:null,translationModel:null})=>{const{model:H,translationModel:J,chainPrefix:K,enableTranslations:L=!1,recursive:Q=!1}=O;if(H){if(F(e))U(e,H,J,K);else if(D(e)){const D=e;if(window.WebCardinal.components.tags.has(D.tagName.toLowerCase()))return;if(E.includes(D.tagName.toLowerCase()))return o(D,H,b,K);if(D.hasAttribute(C)){let e;D.hasAttribute(N)&&(e=D.getAttribute(N),(null==e?void 0:e.startsWith(b))&&(e=e.slice(1)));const t=n(K,e);D[T]=()=>H.hasExpression(t)?H.evaluateExpression(t):H.toObject(t)}const R=d(D,j),X=d(D,u);if(R&&X)console.error("Cannot use both data-if and data-for attributes on the same element",D);else if(R)!function(e,t,{model:a,translationModel:d,chainPrefix:f,enableTranslations:u=!1}={model:null,translationModel:null}){let h=e.getAttribute(j);if(!h.startsWith(b))return void console.warn(`Attribute "${j}" doesn't start with the chain prefix!`);h=h.slice(1);const m=n(f,h),p=Array.from(e.children);let v;!function(e){e.TRUE="webcardinal:data-if:true",e.FALSE="webcardinal:data-if:false",e.LOADING="webcardinal:data-if:loading",e.NO_DATA="webcardinal:data-if:no-data"}(v||(v={}));let x,w="webcardinal:data-if:first-render";x=c(p,A);const $=c(p,g),M=c(p,k),E=c(p,P);[x,$,M,E].find((e=>e.length>0))||(x=Array.from(e.childNodes)),r(e,a);const O=async e=>{switch(typeof e){case"boolean":return e?v.TRUE:v.FALSE;case"number":return Number.isNaN(e)?v.FALSE:v.TRUE;case"string":return 0===e.length?v.FALSE:v.TRUE;case"object":if(e instanceof Promise)try{return w=v.LOADING,C(),O(await e)}catch(e){return console.error("data-if condition async function failed!",e),v.LOADING}return null===e?v.FALSE:Array.isArray(e)?0===e.length?v.NO_DATA:v.TRUE:0===Object.keys(e).length?v.NO_DATA:v.TRUE;case"undefined":return v.LOADING;default:return v.TRUE}},C=()=>{let n;switch(w){case v.NO_DATA:if(0===E.length){n=x;break}n=E;break;case v.LOADING:if(0===M.length){n=$;break}n=M;break;case v.FALSE:n=$;break;default:n=x}r(e,a),n.forEach((n=>{const o=n.cloneNode(!0);l(o),e.appendChild(o),t(o,{model:a,translationModel:d,chainPrefix:f,enableTranslations:u,recursive:!0})}))},N=async e=>{const n=await O(e),t=w!==n;w=n,t&&C()};if(N(a.getChainValue(m)),o(e,a,b,f),u&&o(e,d,y,f),a.hasExpression(m)){N(a.evaluateExpression(m));const n=()=>{N(a.evaluateExpression(m))};a.onChangeExpressionChain(m,n),i(e,m,n)}else{const n=()=>{N(a.getChainValue(m))};a.onChange(m,n),s(e,m,n)}}(D,G.bindElement,O);else if(X)!function(e,c,{model:d,translationModel:f,chainPrefix:j,enableTranslations:A=!1}={model:null,translationModel:null}){let g=e.getAttribute(u);if(!g.startsWith(b))return void console.warn(`Attribute "${u}" doesn't start with the chain prefix!`);g=g.slice(1);const k=n(j,g),P=function(e){return(e.getAttribute(h)||"").split(" ").filter(String)}(e),E=P.includes(m),O=P.includes(p),C=P.includes(v),N=[],T=[],V=[];let W,B,z=[];const D=e=>{Array.isArray(e)?(W=e,B=e.length):(W=void 0,B=-1)},F=n=>{n.forEach((n=>{const t=n.cloneNode(!0);l(t),e.appendChild(t),c(t,{model:d,translationModel:f,chainPrefix:j,enableTranslations:A,recursive:!0})}))},U=()=>{if(-1===B)return r(e,d),void F(T);if(0===B)return r(e,d),void F(N);if(C){const n=document.createElement(e.tagName),t=Array.prototype.slice.call(e.attributes);let a;for(;a=t.pop();)a.nodeName!==h&&n.setAttribute(a.nodeName,a.nodeValue);P.length>0&&n.setAttribute(h,P.join(" ")),e.insertAdjacentElement("afterend",n),e.remove(),e=n}W.forEach(((t,a)=>{const o=[];V.forEach((e=>{const t=e.cloneNode(!0),s=n(k,a);c(t,{model:d,translationModel:f,chainPrefix:s,enableTranslations:A,recursive:!0}),o.push(t)})),z[a]?o.forEach(((e,n)=>{document.createElement("div").appendChild(z[a][n].cloneNode(!0));const t=I(e),o=I(z[a][n]);q(t,o,z[a][n])})):(o.forEach((n=>{e.appendChild(n)})),z[a]=o)}));for(let e=B;e<z.length;e++)z[e].forEach((e=>{r(e,d),e.remove()}));z.splice(B)},G=(n,t=!1)=>{const a=Array.isArray(n)?n.length:-1,o=B!==a;return D(n),O?(U(),void(E&&e.dispatchEvent(new CustomEvent($,{bubbles:!0,cancelable:!0,composed:!0})))):t||o?(r(e,d),z=[],U(),void(E&&e.dispatchEvent(new CustomEvent(M,{bubbles:!0,cancelable:!0,composed:!0})))):void 0},H=({targetChain:e})=>{const n=k===e;G(d.getChainValue(k),n)};for(D(d.getChainValue(k)),t(e,k);e.childNodes.length>0;){const n=e.childNodes[0];S(n,w)?N.push(n):S(n,x)?T.push(n):V.push(n),a(n,d),n.remove()}if(U(),o(e,d,b,j),A&&o(e,f,y,j),d.onChange(k,H),s(e,k,H),d.hasExpression(k)){const n=()=>{G(d.evaluateExpression(k))};d.onChangeExpressionChain(k,n),i(e,k,n)}}(D,G.bindElement,O);else{const e=D.hasAttribute(V),t=D.hasAttribute(N);if(!D.hasAttribute(W)){if(e||t){let a;if(e?a=D.getAttribute(V):(console.warn(`Attribute "${N}" is deprecated for binding! Use the "${V}" key attribute instead.`,D),a=D.getAttribute(N)),a.startsWith(b)){a=a.slice(1);const e=n(K,a);D.setAttribute(V,`${b}${e}`),t&&D.setAttribute(N,`${b}${e}`),z(D,H,e),f(D,H,e);const o=()=>z(D,H,e);if(H.onChange(e,o),s(D,a,o),H.hasExpression(e)){const n=()=>z(D,H,e);H.onChangeExpressionChain(e,n),i(D,e,n)}}else console.warn(`Invalid chain found! (chain: "${a}")!\n`,`A valid chain must start with "${b}".\n`,"target element:",D)}D.tagName.startsWith(B.toUpperCase())||o(D,H,b,K),L&&o(D,J,y,K),Array.from(D.childNodes).filter(F).forEach((e=>{U(e,H,J,K)}))}Q&&Array.from(D.children).forEach((e=>{G.bindElement(e,O)}))}}}else{const n=D(e)?e.tagName.toLowerCase():"text node";console.warn(`No model found for: ${n}!`)}},bindChildNodes:(e,n)=>{Array.from(e.childNodes).forEach((e=>{G.bindElement(e,Object.assign({},n))}))}};export{G as B,D as a,F as i}