import{r as t,c as a,h as n,H as i}from"./p-d4191909.js";import"./p-8fa78097.js";import{d as e,F as o,l as r,m as s,q as l,p as c}from"./p-856e6638.js";import{H as h}from"./p-813bc48c.js";import{C as d}from"./p-173c2a35.js";import{p}from"./p-f8a2682a.js";import"./p-e506992e.js";import{i as b,a as u,B as f}from"./p-62c01f8b.js";const g=class{constructor(i){t(this,i),this.getModelEvent=a(this,"webcardinal:model:get",7),this.pageSize=20,this.pageSizeDelta=2,this.curentPageIndex=0,this.hidePagination=!1,this.templateChildrenCount=0,this.childrenCount=0,this.getTemplatesFromDOM=()=>{const t={header:[],data:[]},a=Object.keys(t);for(const n of Array.from(this.host.childNodes))if(b(n))t.data.push(n);else if(u(n)){const i=n;if(!i.hasAttribute("slot")){t.data.push(i),this.childrenCount++;continue}if(a.includes(i.slot)){const{slot:a}=i;i.removeAttribute("slot"),i.classList.add("webc-datatable--"+a),t[a].push(i),this.childrenCount++}}return t},this.getDataSourceFromModel=async()=>{let{chain:t}=this;return t.startsWith(e)&&(t=t.substring(1)),(await p(this.getModelEvent)).getChainValue(t)},this.renderPagination=()=>{const t=this.curentPageIndex+1,a=this.dataSize?Math.ceil(this.dataSize/this.pageSize):1,i=[],e=function(t,a,n=2){const i=[],e=[];if(a<=1)return i;i.push(1);for(let e=t-n;e<=t+n;e++)e<a&&e>1&&i.push(e);let o;i.push(a);for(let t of i)o&&(t-o==2?e.push(o+1):t-o!=1&&e.push("...")),e.push(t),o=t;return e}(t,a,this.pageSizeDelta);for(const a of e)if("number"!=typeof a)"string"==typeof a&&i.push(a);else{if(a===t){i.push(n("button",{active:!0,part:"pagination-button pagination-button--active",disabled:!0},a));continue}i.push(n("button",{part:"pagination-button",onClick:()=>this.dataSource.goToPageByIndex(a-1)},a))}return 1!==a&&(i.unshift(n("button",{part:"pagination-button pagination-button--previous",disabled:1===t,onClick:()=>this.dataSource.goToPreviousPage()},"‹")),i.push(n("button",{part:"pagination-button pagination-button--next",disabled:t===a,onClick:()=>this.dataSource.goToNextPage()},"›"))),i}}async componentWillLoad(){if(!this.host.isConnected)return;this.dataSource=await this.getDataSourceFromModel();const{DataSource:t}=window.WebCardinal.dataSources;if(!(this.dataSource&&"object"==typeof this.dataSource&&this.dataSource instanceof t))return void console.error(`An invalid WebCardinal DataSource instance received: "${this.chain}"! [1]`,this.dataSource);try{this.model=await this.dataSource._init((()=>this.host))}catch(t){return console.error(`An invalid WebCardinal DataSource instance received: "${this.chain}"! [2]`,this.dataSource),void(this.dataSource=void 0)}const{header:a,data:n}=this.getTemplatesFromDOM();this.host.classList.add("webc-datatable");const i=document.createElement("style");i.innerHTML='\n[data-sortable] {\n    --header-arrow-size: 0.25rem;\n    --header-arrow-color: #BBBBBB;\n\n    cursor: pointer;\n    position: relative;\n    padding-right: calc(5 * var(--header-arrow-size));\n}\n\n[data-sortable]::before,\n[data-sortable]::after {\n    content: "";\n    height: 0;\n    width: 0;\n    position: absolute;\n    right: 4px;\n    border-left: var(--header-arrow-size) solid transparent;\n    border-right: var(--header-arrow-size) solid transparent;\n    opacity: 1;\n}\n\n[data-sortable]::before {\n    border-bottom: var(--header-arrow-size) solid var(--header-arrow-color);\n    border-top: var(--header-arrow-size) solid transparent;\n    bottom: 55%;\n}\n\n[data-sortable]::after {\n    border-top: var(--header-arrow-size) solid var(--header-arrow-color);\n    top: 55%;\n}\n';const h=document.createElement("div");h.setAttribute("slot","data"),h.classList.add("webc-datatable--container"),h.setAttribute("data-for-children-count",""+this.childrenCount),h.setAttribute(o,e+"data"),h.setAttribute(r,""+s),h.append(...n),h.addEventListener(l,(t=>{t.stopImmediatePropagation(),h.prepend(...a)})),h.addEventListener(c,(t=>{t.stopImmediatePropagation()})),this.host.append(i,h),f.bindChildNodes(this.host,{model:this.model,translationModel:{},recursive:!0,enableTranslations:!1}),this.listeners=new d(this.host,{model:this.model,translationModel:{},chain:e+"data"}),this.listeners.getModel.add(),this.listeners.getTranslationModel.add(),this.listeners.getParentChain.add(),h.prepend(...a),this.dataSource._renderPageAsync()}async connectedCallback(){if(this.listeners){const{getModel:t,getTranslationModel:a,getParentChain:n}=this.listeners;null==t||t.add(),null==a||a.add(),null==n||n.add()}}async disconnectedCallback(){if(this.listeners){const{getModel:t,getTranslationModel:a,getParentChain:n}=this.listeners;null==t||t.remove(),null==a||a.remove(),null==n||n.remove()}}async fillCurrentPage(t){this.model.data=t}async clearCurrentPage(){this.model.data.length=0}pageSizeHandler(){this.dataSource._renderPageAsync()}render(){return this.dataSource?n(i,null,n("slot",{name:"before"}),n("slot",{name:"data"}),this.hidePagination?null:n("div",{part:"pagination",class:"pagination"},this.renderPagination()),n("slot",{name:"footer"}),n("slot",{name:"after"})):null}static get watchers(){return{pageSize:["pageSizeHandler"]}}};(function(t,a,n,i){var e,o=arguments.length,r=o<3?a:null===i?i=Object.getOwnPropertyDescriptor(a,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,a,n,i);else for(var s=t.length-1;s>=0;s--)(e=t[s])&&(r=(o<3?e(r):o>3?e(a,n,r):e(a,n))||r);o>3&&r&&Object.defineProperty(a,n,r)})([h()],g.prototype,"host",void 0),g.style={default:":host .pagination{display:flex;gap:var(--pagination-gap);justify-content:center}:host .pagination>button{font-size:inherit;border:var(--pagination-button-border);background:var(--pagination-button-background)}:host .pagination>button:not([disabled]){cursor:pointer}:host .pagination>button[active]{color:inherit;font-weight:bold}"};export{g as webc_datatable}