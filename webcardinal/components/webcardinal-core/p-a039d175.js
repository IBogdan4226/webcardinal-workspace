import{s as e,u as n,B as t,z as o,k as s,x as a,y as i,t as r,r as l,o as c,n as d,m as f}from"./p-138a366d.js";import{F as u,d as b,m as h,n as m,o as v,p,l as x,e as y,k as $,q as M,r as w,I as A,t as j,u as g,v as P,g as E,N as k,i as C,b as N,j as O,V as T,D as V,h as W}from"./p-7abb90e5.js";import{c as B,d as I}from"./p-e506992e.js";function q(n,t,o){const s=t.getChainValue(o);if(s){for(const[t,o]of Object.entries(s))e(n,{key:t,value:o});if(!0===s._saveElement){for(const e in n)"function"==typeof n[e]&&(n[e]=n[e].bind(n));s.getElement||t.setChainValue(o,Object.assign(Object.assign({},s),{getElement:()=>n}))}}if(t.hasExpression(o)){const s=t.evaluateExpression(o);for(const[t,o]of Object.entries(s))e(n,{key:t,value:o})}}function z(e){return e.nodeType===Node.ELEMENT_NODE}function D(e){return e.nodeType===Node.TEXT_NODE&&e.nodeValue&&e.nodeValue.trim()}function F(e,n){return z(e)&&e.getAttribute("slot")===n}function S(e,t,o,s=null){if(E.includes(e.nodeName.toLowerCase()))return;if(e.nodeType!==Node.TEXT_NODE||!e.nodeValue||!e.nodeValue.trim())return;const r=[...e.nodeValue.matchAll(/\{\{\s*([^\s}}]+)\s*\}\}/g)];if(!r.length)return;const l=r.map((e=>({expression:e[0],chainWithPrefix:e[1]}))).filter((({chainWithPrefix:e})=>e.startsWith(b)||e.startsWith(y))).map((e=>{let{chainWithPrefix:a}=e;const i=a.startsWith(y);let r=e.chainWithPrefix.slice(1);!i&&s&&(r=n(s,r),a=`${b}${r}`);const l=i?o:t;return Object.assign(Object.assign({},e),{chain:r,isTranslation:i,isModel:!i,isModelExpression:l.hasExpression(r),evaluateModelExpression:()=>l.evaluateExpression(r),model:l,getChainValue:()=>{let e=l.getChainValue(r);if(i&&void 0===e){const{pathname:n}=window.location,t=k();console.warn(`No translations found for skin "${t}", page "${n}" and chain "${r}"`),e=r}return e}})}));if(!l.length)return;const c=e.nodeValue,d=()=>{let n=c;l.forEach((({expression:e,getChainValue:t,isModelExpression:o,evaluateModelExpression:s})=>{let a=t();["number","boolean"].includes(typeof a)&&(a=a.toString()),!a&&o&&(a=o?s():""),n=n.replace(e,a||"")})),e.nodeValue=n};d(),l.filter((e=>e.isModel)).forEach((({model:n,chain:t,isModelExpression:o})=>{const s=()=>{d()};if(n.onChange(t,s),a(e,t,s),o){const o=()=>{d()};n.onChangeExpressionChain(t,o),i(e,t,o)}}))}const U={bindElement:(e,k={model:null,translationModel:null})=>{const{model:G,translationModel:H,chainPrefix:J,enableTranslations:K=!1,recursive:L=!1}=k;if(G){if(D(e))S(e,G,H,J);else if(z(e)){const z=e;if(window.WebCardinal.components.tags.has(z.tagName.toLowerCase()))return;if(E.includes(z.tagName.toLowerCase()))return s(z,G,b,J);if(z.hasAttribute(C)){let e;z.hasAttribute(N)&&(e=z.getAttribute(N),(null==e?void 0:e.startsWith(b))&&(e=e.slice(1)));const t=n(J,e);z[O]=()=>G.hasExpression(t)?G.evaluateExpression(t):G.toObject(t)}const Q=d(z,A),R=d(z,u);if(Q&&R)console.error("Cannot use both data-if and data-for attributes on the same element",z);else if(Q)!function(e,t,{model:o,translationModel:d,chainPrefix:f,enableTranslations:u=!1}={model:null,translationModel:null}){let h=e.getAttribute(A);if(!h.startsWith(b))return void console.warn(`Attribute "${A}" doesn't start with the chain prefix!`);h=h.slice(1);const m=n(f,h),v=Array.from(e.children);let p="webcardinal:data-if:undefined",x=c(v,j);const $=c(v,g),M=c(v,P);x.length||$.length||(x=Array.from(e.childNodes)),r(e,o);const w=async n=>{const s=await(async e=>{switch(typeof e){case"boolean":return e;case"function":if(e instanceof Promise)try{return await e()}catch(e){return void console.error("data-if condition async function failed!",e)}try{return e()}catch(e){return void console.error("data-if condition function failed!",e)}default:return}})(n),a=p!==s;p=s,a&&(()=>{let n;switch(p){case!0:n=x;break;case!1:n=$;break;default:n=M}r(e,o),n.forEach((n=>{const s=n.cloneNode(!0);l(s),e.appendChild(s),t(s,{model:o,translationModel:d,chainPrefix:f,enableTranslations:u,recursive:!0})}))})()};if(w(o.getChainValue(m)),s(e,o,b,f),u&&s(e,d,y,f),o.hasExpression(m)){w(o.evaluateExpression(m));const n=()=>{w(o.evaluateExpression(m))};o.onChangeExpressionChain(m,n),i(e,m,n)}else{const n=()=>{w(o.getChainValue(m))};o.onChange(m,n),a(e,m,n)}}(z,U.bindElement,k);else if(R)!function(e,c,{model:d,translationModel:f,chainPrefix:A,enableTranslations:j=!1}={model:null,translationModel:null}){let g=e.getAttribute(u);if(!g.startsWith(b))return void console.warn(`Attribute "${u}" doesn't start with the chain prefix!`);g=g.slice(1);const P=n(A,g),E=function(e){return(e.getAttribute(h)||"").split(" ").filter(String)}(e),k=E.includes(m),C=E.includes(v),N=E.includes(p),O=[],T=[],V=[];let W,q,z=[];const D=e=>{Array.isArray(e)?(W=e,q=e.length):(W=void 0,q=-1)},S=n=>{n.forEach((n=>{const t=n.cloneNode(!0);l(t),e.appendChild(t),c(t,{model:d,translationModel:f,chainPrefix:A,enableTranslations:j,recursive:!0})}))},U=()=>{if(-1===q)return r(e,d),void S(T);if(0===q)return r(e,d),void S(O);if(N){const n=document.createElement(e.tagName),t=Array.prototype.slice.call(e.attributes);let o;for(;o=t.pop();)o.nodeName!==h&&n.setAttribute(o.nodeName,o.nodeValue);E.length>0&&n.setAttribute(h,E.join(" ")),e.insertAdjacentElement("afterend",n),e.remove(),e=n}W.forEach(((t,o)=>{const s=[];V.forEach((e=>{const t=e.cloneNode(!0),a=n(P,o);c(t,{model:d,translationModel:f,chainPrefix:a,enableTranslations:j,recursive:!0}),s.push(t)})),z[o]?s.forEach(((e,n)=>{document.createElement("div").appendChild(z[o][n].cloneNode(!0));const t=B(e),s=B(z[o][n]);I(t,s,z[o][n])})):(s.forEach((n=>{e.appendChild(n)})),z[o]=s)}));for(let e=q;e<z.length;e++)z[e].forEach((e=>{r(e,d),e.remove()}));z.splice(q)},G=(n,t=!1)=>{const o=Array.isArray(n)?n.length:-1,s=q!==o;return D(n),C?(U(),void(k&&e.dispatchEvent(new CustomEvent(M,{bubbles:!0,cancelable:!0,composed:!0})))):t||s?(r(e,d),z=[],U(),void(k&&e.dispatchEvent(new CustomEvent(w,{bubbles:!0,cancelable:!0,composed:!0})))):void 0},H=({targetChain:e})=>{const n=P===e;G(d.getChainValue(P),n)};for(D(d.getChainValue(P)),t(e,P);e.childNodes.length>0;){const n=e.childNodes[0];F(n,$)?O.push(n):F(n,x)?T.push(n):V.push(n),o(n,d),n.remove()}if(U(),s(e,d,b,A),j&&s(e,f,y,A),d.onChange(P,H),a(e,P,H),d.hasExpression(P)){const n=()=>{G(d.evaluateExpression(P))};d.onChangeExpressionChain(P,n),i(e,P,n)}}(z,U.bindElement,k);else{const e=z.hasAttribute(T),t=z.hasAttribute(N);if(!z.hasAttribute(V)){if(e||t){let o;if(e?o=z.getAttribute(T):(console.warn(`Attribute "${N}" is deprecated for binding! Use the "${T}" key attribute instead.`,z),o=z.getAttribute(N)),o.startsWith(b)){o=o.slice(1);const e=n(J,o);z.setAttribute(T,`${b}${e}`),t&&z.setAttribute(N,`${b}${e}`),q(z,G,e),f(z,G,e);const s=()=>q(z,G,e);if(G.onChange(e,s),a(z,o,s),G.hasExpression(e)){const n=()=>q(z,G,e);G.onChangeExpressionChain(e,n),i(z,e,n)}}else console.warn(`Invalid chain found! (chain: "${o}")!\n`,`A valid chain must start with "${b}".\n`,"target element:",z)}z.tagName.startsWith(W.toUpperCase())||s(z,G,b,J),K&&s(z,H,y,J),Array.from(z.childNodes).filter(D).forEach((e=>{S(e,G,H,J)}))}L&&Array.from(z.children).forEach((e=>{U.bindElement(e,k)}))}}}else{const n=z(e)?e.tagName.toLowerCase():"text node";console.warn(`No model found for: ${n}!`)}},bindChildNodes:(e,n)=>{Array.from(e.childNodes).forEach((e=>{U.bindElement(e,Object.assign({},n))}))}};export{U as B,z as a,D as i}