import{r as t,h as i,g as A}from"./p-8ea2992d.js";import{B as e,T as s}from"./p-3551bb79.js";const o=new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");function n(t,i){let A,e,s,o;const n=()=>{s=t.width*(i.height/t.height),o=i.height,A=.5*(i.width-s),e=0},a=()=>{s=i.width,o=t.height*(i.width/t.width),A=0,e=.5*(i.height-o)};return t.height<=t.width?(n(),A>0&&e<=0&&a()):(a(),A<=0&&e>0&&n()),[A,e,s,o]}function a(t,i){i||(i={}),i.style||(i.style={}),i.text||(i.text="");const{style:A,text:e}=i;delete i.style,delete i.text;const s=Object.assign(document.createElement(t),i);return Object.keys(A).forEach((t=>s.style[t]=A[t])),s.innerHTML=e,s}const h={base:{display:"grid",gridTemplateRows:"1fr",width:"100%",height:"100%"},container:{position:"relative",display:"grid",gridTemplateRows:"1fr",overflow:"hidden",minHeight:"350px",padding:"0",margin:"0"},video:{height:"100%",width:"100%",objectFit:"cover"},invertedVideo:{height:"100%",width:"100%",objectFit:"cover",position:"absolute",top:"0"},input:{display:"none"},button:{position:"absolute",zIndex:"1",padding:"0.3em 0.6em",bottom:"1em",left:"50%",transform:"translateX(-50%)",color:"#FFFFFF",background:"transparent",borderRadius:"2px",border:"2px solid rgba(255, 255, 255, 0.75)",fontSize:"15px",textAlign:"center"}};var c,d=function(t,i,A,e){var s,o=arguments.length,n=o<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,A):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,i,A,e);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(i,A,n):s(i,A))||n);return o>3&&n&&Object.defineProperty(i,A,n),n};!function(t){t.INIT="Initializing component...",t.LOAD_CAMERAS="Detecting your cameras...",t.IN_PROGRESS="Camera detection in progress...",t.DONE="Scan done.",t.NO_DETECTION="No camera detected.",t.ACCESS_DENIED="Access denied",t.CHANGE_CAMERA="Change camera"}(c||(c={}));const r={init:a("div",{style:h.button,text:"Booting camera..."}),active:a("button",{style:h.button,text:"Change camera"}),done:a("div",{style:h.button,text:"Scan complete!"}),error:a("div",{style:h.button,text:"No camera device found!"}),feedback:a("div",{style:h.button,text:"Checking permissions..."}),access_denied:a("div",{style:h.button,text:"Access denied..."})};r.active.setAttribute("change-camera","");const l={width:NaN,height:NaN},m=class{constructor(i){t(this,i),this.noLogs=!1,this.useFrames=!1,this.status=c.INIT,this.devices=[],this.useFramesContext={canvas:void 0,context:void 0,stream:void 0},this.createCustomizedElement=t=>this.host.querySelector(`[slot=${t}]`)?a("slot",{name:t}):(r[t].part=t,r[t]),this.renderContent=()=>{let t;switch(this.noLogs||console.log("Status:",this.status),this.status){case c.INIT:t=this.createCustomizedElement("init");break;case c.NO_DETECTION:t=this.createCustomizedElement("error");break;case c.DONE:t=this.createCustomizedElement("done");break;case c.LOAD_CAMERAS:t=this.createCustomizedElement("feedback");break;case c.ACCESS_DENIED:t=this.createCustomizedElement("access_denied");break;default:t=this.createCustomizedElement("active")}const i=a("div");return i.append(t),i.innerHTML},this.drawOverlays=async()=>{if(!this.host||!this.host.shadowRoot||this.host.querySelector("[slot=active]"))return;const{shadowRoot:t}=this.host,i=t.querySelector("#video"),A=t.querySelector("#container"),{VideoOverlay:e}=await import("./p-241598b9.js");this.overlay=new e(A,i),this.overlay.createOverlaysCanvases("lensCanvas","overlayCanvas")&&this.overlay.drawLensCanvas()},this.cleanupOverlays=()=>{this.overlay&&this.overlay.removeOverlays()},this.getInvertedCanvas=()=>{if(!this.host||!this.host.shadowRoot)return;const t=this.host.shadowRoot.querySelector("#container");l.width||(l.width=t.offsetWidth,l.height=t.offsetHeight);const i=a("canvas",{id:"invertedCanvas",width:t.offsetWidth||l.width,height:t.offsetHeight||l.height,style:{position:"absolute",width:"100%",top:0,left:0}}),A=i.captureStream(50);return[i,A]},this.drawInvertedFrame=(t,i)=>{if(this.status===c.DONE)return;const A=i.getContext("2d"),[e,s,o,a]=n({width:t.videoWidth,height:t.videoHeight},i);A.drawImage(t,e,s,o,a);const h=A.getImageData(0,0,i.width,i.height);for(let t=0;t<h.data.length;t+=4)h.data[t]=255^h.data[t],h.data[t+1]=255^h.data[t+1],h.data[t+2]=255^h.data[t+2];A.putImageData(h,0,0),setTimeout((()=>{this.drawInvertedFrame(t,i)}),50)},this.scanUsingFrames=(t,i,A)=>{window.requestAnimationFrame((()=>{const[e,s]=this.getInvertedCanvas();this.drawInvertedFrame(t,e),this.codeReader.decodeFromStream(t.captureStream(30),t,A),this.invertedCodeReader.decodeFromStream(s,i,A)}))},this.scanUsingNavigator=(t,i,A,e)=>{const s={video:{facingMode:"environment"}};t&&"no-camera"!==t&&(delete s.video.facingMode,s.video.deviceId={exact:t}),i.onplay=async()=>{this.status=c.IN_PROGRESS,this.cleanupOverlays(),await this.drawOverlays(),i.removeAttribute("hidden")},navigator.mediaDevices.getUserMedia(s).then((()=>{const[t,o]=this.getInvertedCanvas();this.drawInvertedFrame(i,t),this.codeReader.decodeFromConstraints(s,i,e),this.invertedCodeReader.decodeFromStream(o,A,e)})).catch((t=>{this.status=c.ACCESS_DENIED,console.log("getUserMedia",t)}))},this.scan=t=>{const i=this.host.shadowRoot.querySelector("#video"),A=this.host.shadowRoot.querySelector("#invertedVideo");this.status===c.CHANGE_CAMERA&&(this.codeReader.reset(),this.invertedCodeReader.reset());const e=(t,i)=>{t&&this.status===c.IN_PROGRESS&&(this.noLogs||console.log("Scanned data:",t),this.modelHandler&&(this.modelHandler.updateModel("data",t.text),this.status=c.DONE,o.play(),this.overlay&&this.overlay.drawOverlay(t.resultPoints),setTimeout((()=>{if(this.snapVideo){const t=this.host.shadowRoot.querySelector("video"),i=t.videoHeight,A=t.videoWidth,e=document.createElement("canvas");e.width=A,e.height=i;const s=e.getContext("2d");e.style.width="100%",e.style.height="100%",e.style.objectFit="cover",s.drawImage(t,0,0,A,i),t.parentElement.insertBefore(e,t)}this.codeReader.reset(),this.invertedCodeReader.reset(),this.overlay&&this.overlay.removeOverlays()}),500))),!i||i instanceof this.ZXing.NotFoundException||console.error(i)};this.useFrames?this.scanUsingFrames(i,A,e):this.scanUsingNavigator(t,i,A,e)},this.tryScanning=t=>{switch(this.status){case c.LOAD_CAMERAS:case c.CHANGE_CAMERA:this.scan(t)}},window.addEventListener("resize",(()=>{window.requestAnimationFrame((async()=>{this.cleanupOverlays(),await this.drawOverlays()}))}))}async switchCamera(){let t=[void 0];for(const i of this.devices)t.push(i.deviceId);let i=t.indexOf(this.activeDeviceId);i===t.length-1&&(i=-1),i++,this.activeDeviceId=t[i],this.status=c.CHANGE_CAMERA}async setFrame(t){if(!this.host||!this.host.shadowRoot||!this.useFrames)return;if(!this.useFramesContext.canvas||!this.useFramesContext.stream){const{shadowRoot:t}=this.host,i=t.querySelector("#container"),A=a("canvas",{id:"frameCanvas",width:i.offsetWidth||l.width,height:i.offsetHeight||l.height,style:{position:"absolute",width:"100%",top:0,left:0}}),e=A.captureStream(30);this.useFramesContext.canvas=A,this.useFramesContext.context=A.getContext("2d"),this.useFramesContext.stream=e;const s=this.host.shadowRoot.querySelector("#video");s.onplay=async()=>{this.status=c.IN_PROGRESS,this.cleanupOverlays(),await this.drawOverlays(),s.removeAttribute("hidden")},s.srcObject=this.useFramesContext.stream}const i=new Image;i.addEventListener("load",(()=>{const[t,A,e,s]=n(i,this.useFramesContext.canvas);this.useFramesContext.context.drawImage(i,t,A,e,s)})),i.src=t}async componentWillLoad(){const t=()=>{!window.ZXing||this.ZXing||this.codeReader?setTimeout(t,300):(this.ZXing=window.ZXing,this.codeReader=new this.ZXing.BrowserMultiFormatReader(null,2e3),this.invertedCodeReader=new this.ZXing.BrowserMultiFormatReader(null,50),this.status=c.LOAD_CAMERAS,this.host&&this.host.isConnected||!this.codeReader||!this.invertedCodeReader||(this.status=c.INIT,this.codeReader.reset(),this.invertedCodeReader.reset()))};t()}async componentWillRender(){if(this.ZXing&&(0===this.devices.length||!this.activeDeviceId)){try{this.devices=await this.codeReader.listVideoInputDevices()}catch(t){}0===this.devices.length&&(this.status=c.NO_DETECTION)}}async componentDidRender(){if(!this.host.isConnected)return;this.tryScanning(this.activeDeviceId);const t=this.host.shadowRoot.querySelector("[change-camera]");t&&(t.onclick=async()=>await this.switchCamera())}async disconnectedCallback(){this.codeReader&&this.codeReader.reset(),this.invertedCodeReader&&this.invertedCodeReader.reset()}render(){return[i("script",{async:!0,src:"webcardinal/extended/cardinal-barcode/libs/zxing.min.js"}),i("div",{title:this.host.getAttribute("title"),part:"base",style:h.base},i("div",{id:"container",part:"container",style:h.container},i("input",{type:"file",accept:"video/*",capture:"environment",style:h.input}),i("video",{id:"video",part:"video",muted:!0,autoplay:!0,playsinline:!0,hidden:!0,style:h.video}),i("video",{id:"invertedVideo",muted:!0,autoplay:!0,playsinline:!0,hidden:!0,style:h.invertedVideo}),i("div",{id:"content",part:"content",innerHTML:this.renderContent()})))]}get host(){return A(this)}};d([e()],m.prototype,"modelHandler",void 0),d([s({description:"The data-model that will be updated with the retrieved data from the scanner.",isMandatory:!0,propertyType:"string"})],m.prototype,"data",void 0),d([s({description:"Decides if a screenshot is made after scanning.",isMandatory:!1,propertyType:"boolean"})],m.prototype,"snapVideo",void 0),d([s({description:"Decides if internal status of component is logged.",isMandatory:!1,propertyType:"boolean"})],m.prototype,"noLogs",void 0);export{m as psk_barcode_scanner}