import{r as t,h as i,g as e}from"./p-bca3f9a1.js";import{B as A,T as s}from"./p-90cc8291.js";const o=new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");var n,a=function(t,i,e,A){var s,o=arguments.length,n=o<3?i:null===A?A=Object.getOwnPropertyDescriptor(i,e):A;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,i,e,A);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(n=(o<3?s(n):o>3?s(i,e,n):s(i,e))||n);return o>3&&n&&Object.defineProperty(i,e,n),n};!function(t){t.INIT="Initializing component...",t.LOAD_CAMERAS="Detecting your cameras...",t.IN_PROGRESS="Camera detection in progress...",t.DONE="Scan done.",t.NO_DETECTION="No camera detected.",t.ACCESS_DENIED="Access denied",t.CHANGE_CAMERA="Change camera"}(n||(n={}));const c={base:{display:"grid",gridTemplateRows:"1fr",width:"100%",height:"100%"},container:{position:"relative",display:"grid",gridTemplateRows:"1fr",overflow:"hidden",minHeight:"350px",padding:"0",margin:"0"},video:{height:"100%",width:"100%",objectFit:"cover"},invertedVideo:{height:"100%",width:"100%",objectFit:"cover",position:"absolute",top:"0"},input:{display:"none"},button:{position:"absolute",zIndex:"1",padding:"0.3em 0.6em",bottom:"1em",left:"50%",transform:"translateX(-50%)",color:"#FFFFFF",background:"transparent",borderRadius:"2px",border:"2px solid rgba(255, 255, 255, 0.75)",fontSize:"15px",textAlign:"center"}},h={init:r("div",{style:c.button,text:"Booting camera..."}),active:r("button",{style:c.button,text:"Change camera"}),done:r("div",{style:c.button,text:"Scan complete!"}),error:r("div",{style:c.button,text:"No camera device found!"}),feedback:r("div",{style:c.button,text:"Checking permissions..."}),access_denied:r("div",{style:c.button,text:"Access denied..."})};function r(t,i){i||(i={}),i.style||(i.style={}),i.text||(i.text="");const{style:e,text:A}=i;delete i.style,delete i.text;const s=Object.assign(document.createElement(t),i);return Object.keys(e).forEach((t=>s.style[t]=e[t])),s.innerHTML=A,s}h.active.setAttribute("change-camera","");const d=class{constructor(i){t(this,i),this.status=n.INIT,this.devices=[],this.framesElements={canvas:void 0,context:void 0,stream:void 0},window.addEventListener("resize",(()=>{window.requestAnimationFrame((async()=>{this.cleanupOverlays(),await this.drawOverlays()}))}))}createCustomizedElement(t){return this.host.querySelector(`[slot=${t}]`)?r("slot",{name:t}):(h[t].part=t,h[t])}renderContent(){let t;switch(this.noLogs||console.log("Status:",this.status),this.status){case n.INIT:t=this.createCustomizedElement("init");break;case n.NO_DETECTION:t=this.createCustomizedElement("error");break;case n.DONE:t=this.createCustomizedElement("done");break;case n.LOAD_CAMERAS:t=this.createCustomizedElement("feedback");break;case n.ACCESS_DENIED:t=this.createCustomizedElement("access_denied");break;default:t=this.createCustomizedElement("active")}const i=r("div");return i.append(t),i.innerHTML}async drawOverlays(){if(!this.host||!this.host.shadowRoot||this.host.querySelector("[slot=active]"))return;const{shadowRoot:t}=this.host,i=t.querySelector("#video"),e=t.querySelector("#container"),{VideoOverlay:A}=await import("./p-241598b9.js");this.overlay=new A(e,i),this.overlay.createOverlaysCanvases("lensCanvas","overlayCanvas")&&this.overlay.drawLensCanvas()}cleanupOverlays(){this.overlay&&this.overlay.removeOverlays()}getInvertedCanvas(){if(!this.host||!this.host.shadowRoot)return;const{shadowRoot:t}=this.host,i=t.querySelector("#container"),{offsetWidth:e,offsetHeight:A}=i,s=r("canvas",{id:"invertedCanvas",width:e,height:A,style:{position:"absolute",width:"100%",top:0,left:0}}),o=s.captureStream(50);return[s,o]}drawInvertedFrame(t,i){const e={width:i.width,height:i.height},A=t.videoWidth,s=t.videoHeight,o=i.getContext("2d");{let i,n,a,c;s<=A?(a=A*(e.height/s),c=e.height,i=.5*(e.width-a),n=0):(a=e.width,c=s*(e.width/A),i=0,n=.5*(e.height-c)),o.drawImage(t,i,n,a,c)}const n=o.getImageData(0,0,e.width,e.height);for(let t=0;t<n.data.length;t+=4)n.data[t]=255^n.data[t],n.data[t+1]=255^n.data[t+1],n.data[t+2]=255^n.data[t+2];o.putImageData(n,0,0),setTimeout((()=>{this.drawInvertedFrame(t,i)}),50)}startScanning(t){const i=this.host.shadowRoot.querySelector("#video"),e=this.host.shadowRoot.querySelector("#invertedVideo"),A={video:{facingMode:"environment"}};t&&"no-camera"!==t&&(delete A.video.facingMode,A.video.deviceId={exact:t}),this.status===n.LOAD_CAMERAS&&this.codeReader.playVideoOnLoad(i,(async()=>{this.status=n.IN_PROGRESS,this.cleanupOverlays(),await this.drawOverlays(),i.removeAttribute("hidden")})),this.status===n.CHANGE_CAMERA&&(this.codeReader.reset(),this.invertedCodeReader.reset());const s=(t,i)=>{t&&this.status===n.IN_PROGRESS&&(this.noLogs||console.log("Scanned data:",t),this.modelHandler&&(this.modelHandler.updateModel("data",t.text),this.status=n.DONE,o.play(),this.overlay&&this.overlay.drawOverlay(t.resultPoints),setTimeout((()=>{if(this.snapVideo){const t=this.host.shadowRoot.querySelector("video"),i=t.videoHeight,e=t.videoWidth,A=document.createElement("canvas");A.width=e,A.height=i;const s=A.getContext("2d");A.style.width="100%",A.style.height="100%",A.style.objectFit="cover",s.drawImage(t,0,0,e,i),t.parentElement.insertBefore(A,t)}this.codeReader.reset(),this.invertedCodeReader.reset(),this.overlay&&this.overlay.removeOverlays()}),500))),!i||i instanceof this.ZXing.NotFoundException||console.error(i)};if(this.host.hasAttribute("override-frames")){const[t,A]=this.getInvertedCanvas();this.drawInvertedFrame(i,t),this.codeReader.decodeFromStream(i.captureStream(30),i,s),this.invertedCodeReader.decodeFromStream(A,e,s)}else navigator.mediaDevices.getUserMedia(A).then((()=>{const[t,o]=this.getInvertedCanvas();this.drawInvertedFrame(i,t),this.codeReader.decodeFromConstraints(A,i,s),this.invertedCodeReader.decodeFromStream(o,e,s)})).catch((t=>{this.status=n.ACCESS_DENIED,console.log("getUserMedia",t)}))}tryScanning(t){switch(this.status){case n.LOAD_CAMERAS:case n.CHANGE_CAMERA:this.startScanning(t)}}async switchCamera(){let t=[void 0];for(const i of this.devices)t.push(i.deviceId);let i=t.indexOf(this.activeDeviceId);i===t.length-1&&(i=-1),i++,this.activeDeviceId=t[i],this.status=n.CHANGE_CAMERA}async setFrame(t){if(!this.host||!this.host.shadowRoot)return;if(!this.framesElements.canvas||!this.framesElements.stream){const{shadowRoot:t}=this.host,i=t.querySelector("#container"),{offsetWidth:e,offsetHeight:A}=i,s=r("canvas",{id:"frameCanvas",width:e,height:A,style:{position:"absolute",width:"100%",top:0,left:0}}),o=s.captureStream(30);this.framesElements.canvas=s,this.framesElements.context=s.getContext("2d"),this.framesElements.stream=o,this.host.shadowRoot.querySelector("#video").srcObject=this.framesElements.stream}const i=new Image;i.onload=()=>{const t={width:this.framesElements.canvas.width,height:this.framesElements.canvas.height};let e,A,s,o;i.height<=i.width?(s=i.width*(t.height/i.height),o=t.height,e=.5*(t.width-s),A=0):(s=t.width,o=i.height*(t.width/i.width),e=0,A=.5*(t.height-o)),this.framesElements.context.drawImage(i,e,A,s,o)},i.src=t}async componentWillLoad(){const t=()=>{!window.ZXing||this.ZXing||this.codeReader?setTimeout(t,300):(this.ZXing=window.ZXing,this.codeReader=new this.ZXing.BrowserMultiFormatReader(null,2e3),this.invertedCodeReader=new this.ZXing.BrowserMultiFormatReader(null,50),this.status=n.LOAD_CAMERAS,this.host&&this.host.isConnected||!this.codeReader||!this.invertedCodeReader||(this.status=n.INIT,this.codeReader.reset(),this.invertedCodeReader.reset()))};t()}async componentWillRender(){if(this.ZXing&&(0===this.devices.length||!this.activeDeviceId)){try{this.devices=await this.codeReader.listVideoInputDevices()}catch(t){}0===this.devices.length&&(this.status=n.NO_DETECTION)}}async componentDidRender(){if(!this.host.isConnected)return;this.tryScanning(this.activeDeviceId);const t=this.host.shadowRoot.querySelector("[change-camera]");t&&(t.onclick=async()=>await this.switchCamera())}async disconnectedCallback(){this.codeReader&&this.codeReader.reset(),this.invertedCodeReader&&this.invertedCodeReader.reset()}render(){return[i("script",{async:!0,src:"webcardinal/extended/cardinal-barcode/libs/zxing.js"}),i("div",{title:this.host.getAttribute("title"),part:"base",style:c.base},i("div",{id:"container",part:"container",style:c.container},i("input",{type:"file",accept:"video/*",capture:"environment",style:c.input}),i("video",{id:"video",part:"video",muted:!0,autoplay:!0,playsinline:!0,hidden:!0,style:c.video}),i("video",{id:"invertedVideo",muted:!0,autoplay:!0,playsinline:!0,hidden:!0,style:c.invertedVideo}),i("div",{id:"content",part:"content",innerHTML:this.renderContent()})))]}get host(){return e(this)}};a([A()],d.prototype,"modelHandler",void 0),a([s({description:"The data-model that will be updated with the retrieved data from the scanner.",isMandatory:!0,propertyType:"string"})],d.prototype,"data",void 0),a([s({description:"Decides if a screenshot is made after scanning.",isMandatory:!1,propertyType:"boolean"})],d.prototype,"snapVideo",void 0),a([s({description:"Decides if internal status of component is logged.",isMandatory:!1,propertyType:"boolean"})],d.prototype,"noLogs",void 0);export{d as psk_barcode_scanner}