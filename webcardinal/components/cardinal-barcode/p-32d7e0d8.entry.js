import{r as t,h as i,g as e}from"./p-104362b3.js";import{B as s}from"./p-08edb5b9.js";const n=new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU="),o={default:t=>t.imageData,otsuThresholding:t=>{const{imageData:i}=t;return function(t,i){for(let e=0;e<t.data.length;e+=4)t.data[e]=t.data[e+1]=t.data[e+2]=t.data[e+1]>i?255:0}(i,function(t,i){let e=0;for(let i=0;i<256;i++)e+=i*t[i];let s=0,n=0,o=0,a=0,r=0;for(let c=0;c<256;c++){if(n+=t[c],0==n)continue;if(o=i-n,0==o)break;s+=c*t[c];let A=s/n,h=(e-s)/o,d=n*o*(A-h)*(A-h);d>a&&(a=d,r=c)}return r}(function(t){const i=new Uint16Array(256);for(let e=0;e<t.data.length;e+=4)i[t.data[e]=Math.round(.2126*t.data[e]+.7152*t.data[e+1]+.0722*t.data[e+2])]++;return i}(i),i.width*i.height)),i}},a=t=>{let i=!1,e=t;t.endsWith("Inverted")&&(i=!0,e=t.slice(0,-8));const s=o[e];return i?t=>{const i=s(t);return function(t){for(let i=0;i<t.data.length;i+=4)t.data[i]=255^t.data[i],t.data[i+1]=255^t.data[i+1],t.data[i+2]=255^t.data[i+2]}(i),i}:s};function r(t){const i=t.getBoundingClientRect();return i.top>=0&&i.left>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&i.right<=(window.innerWidth||document.documentElement.clientWidth)}function c(t,i,e){e&&"object"==typeof e||(e={}),"boolean"!=typeof e.stopInternalCropping&&(e.stopInternalCropping=!1);const s=i.getContext("2d");if(s.imageSmoothingEnabled=!1,e.points&&6===e.points.length){const[i,n,o,a,r,c,A,h]=e.points;return s.imageSmoothingEnabled=!1,s.drawImage(t,i,n,o,a,r,c,A,h),e.points}const n={width:i.width,height:i.height};if(t instanceof HTMLVideoElement?t.videoWidth&&(n.width=t.videoWidth,n.height=t.videoHeight):(n.width=t.width,n.height=t.height),e.stopInternalCropping){i.width=n.width,i.height=n.height;const e=[0,0,n.width,n.height,0,0,n.width,n.height];return s.drawImage.apply(s,[t,...e]),e}let[o,a]=function(t,i){const e=Math.min(t.width/i.width,t.height/i.height);return[i.width*e,i.height*e]}(n,i);i.width=Math.floor(o),i.height=Math.floor(a);let[r,c]=function(t,i){const e=Math.max(t.width,i.width),s=Math.max(t.height,i.height);return[.5*(e-Math.min(t.width,i.width)),.5*(s-Math.min(t.height,i.height))]}(i,n),A=[r,c,i.width,i.height,0,0,i.width,i.height];return s.drawImage.apply(s,[t,...A]),A}function A(){return new Promise((t=>{window.requestAnimationFrame(t)}))}function h(t,i){i||(i={}),i.style||(i.style={}),i.text||(i.text="");const{style:e,text:s}=i;delete i.style,delete i.text;const n=Object.assign(document.createElement(t),i);return Object.keys(e).forEach((t=>n.style[t]=e[t])),n.innerHTML=s,n}const d=()=>{const t=document.createElement("style");return t.append("\n*::-webkit-media-controls-panel {\n  display: none !important;\n  -webkit-appearance: none;\n}\n*::-webkit-media-controls-play-button {\n  display: none !important;\n  -webkit-appearance: none;\n}\n*::-webkit-media-controls-start-playback-button {\n  display: none !important;\n  -webkit-appearance: none;\n}"),t.innerHTML},l={base:{display:"grid",gridTemplateRows:"1fr",width:"100%",height:"100%"},container:{position:"relative",display:"grid",gridTemplateRows:"1fr",overflow:"hidden",minHeight:"350px",padding:"0",margin:"0"},video:{height:"100%",width:"100%",objectFit:"cover",position:"absolute",top:"0"},input:{display:"none"},button:{position:"absolute",zIndex:"1",padding:"0.3em 0.6em",bottom:"1em",left:"50%",transform:"translateX(-50%)",color:"#FFFFFF",background:"transparent",borderRadius:"2px",border:"2px solid rgba(255, 255, 255, 0.75)",fontSize:"15px",textAlign:"center"}};var u;!function(t){t.INIT="Initializing component...",t.LOADING_CAMERAS="Detecting your cameras...",t.DETECTION_STARTED="Detection is starting...",t.DETECTION_IN_PROGRESS="Detection in progress...",t.DETECTION_DONE="Detection is stopping...",t.NO_DETECTION="No camera detected.",t.ACCESS_DENIED="Access denied",t.CHANGE_CAMERA="Change camera"}(u||(u={}));class w{constructor(t,i){this._status=t,this._isLogging=i}set status(t){this._status=t,this._isLogging&&console.log("[psk-barcode-scanner] Status:",this._status)}get status(){return this._status}}const v={init:h("div",{style:l.button,text:"Booting camera..."}),active:h("button",{style:l.button,text:"Change camera"}),done:h("div",{style:l.button,text:"Scan complete!"}),error:h("div",{style:l.button,text:"No camera device found!"}),feedback:h("div",{style:l.button,text:"Checking permissions..."}),access_denied:h("div",{style:l.button,text:"Access denied..."})};v.active.setAttribute("change-camera","");class g{constructor(t,i){this._source=null,this._canvas=t||null,this._points=i||[],this._filters={order:[],context:{}}}get canvas(){return this._canvas}get points(){return this._points}get filterIds(){return this._filters.order}set source(t){this._source=t}get source(){return this._source}addFilter(t){const{id:i}=t,e=function(t,i){var e={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(e[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(t);n<s.length;n++)i.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(t,s[n])&&(e[s[n]]=t[s[n]])}return e}(t,["id"]);this._filters.order.push(i),this._filters.context[i]=Object.assign({},e)}getFilter(t){return this._filters.context[t]}async scan(){await Promise.all(this._filters.order.map((t=>this._filters.context[t].decode())))}}const m=class{constructor(i){t(this,i),this.snapVideo=!1,this.useFrames=!1,this.useWebWorker=!0,this.useLogs=!0,this.stopInternalCropping=!1,this.state=new w(u.INIT,this.useLogs),this.devices=[],this.frame=new g,this.initializeReferencesToElements=()=>{const t=this.host.shadowRoot.querySelector("#container");if(!t)return void console.error("[psk-barcode-scanner] Component can not render #container");const i=this.host.shadowRoot.querySelector("#video");i?(this.container=t,this.video=i):console.error("[psk-barcode-scanner] Component can not render #video")},this.initializeScanningMethod=async()=>{this.useWebWorker?this.scanWorker||(this.scanWorker=new Worker("webcardinal/extended/cardinal-barcode/worker/scan-worker.js")):this.scanWorker&&this.scanWorker.terminate()},this.createSlotElement=t=>this.host.querySelector(`[slot=${t}]`)?h("slot",{name:t}):(v[t].part=t,v[t]),this.attachOnClickForChangeCamera=()=>{const t=this.host.shadowRoot.querySelector("[change-camera]");t&&(t.onclick=async()=>await this.switchCamera())},this.renderContent=()=>{let t;switch(this.state.status){case u.INIT:t=this.createSlotElement("init");break;case u.NO_DETECTION:t=this.createSlotElement("error");break;case u.DETECTION_DONE:t=this.createSlotElement("done");break;case u.LOADING_CAMERAS:if(this.host.hasAttribute("dev-disable-some-slots"))return void(t="");t=this.createSlotElement("feedback");break;case u.ACCESS_DENIED:t=this.createSlotElement("access_denied");break;default:if(this.host.hasAttribute("dev-disable-some-slots"))return void(t="");t=this.createSlotElement("active")}const i=h("div");return i.append(t),i.innerHTML},this.drawOverlays=async()=>{if(!this.host||!this.host.shadowRoot||this.host.querySelector("[slot=active]"))return;const{shadowRoot:t}=this.host,i=t.querySelector("#video"),e=t.querySelector("#container"),{VideoOverlay:s}=await import("./p-31b4da5d.js");this.overlay=new s(e,i),this.overlay.createOverlaysCanvases("lensCanvas","overlayCanvas")&&this.overlay.drawLensCanvas()},this.cleanupOverlays=()=>{this.overlay&&this.overlay.removeOverlays()},this.onZXingBrowserLoad=async()=>{const t=new Map;t.set(3,!0),this.scanner=new window.ZXingBrowser.BrowserMultiFormatReader(t);const i=async()=>{await this.scan(),await async function(){return new Promise((t=>{const i=setTimeout((()=>{t(),clearTimeout(i)}),250)}))}(),this.state.status===u.DETECTION_IN_PROGRESS&&await i()};await i()},this.onVideoPlay=async()=>{this.cleanupOverlays(),await this.drawOverlays(),this.video.removeAttribute("hidden")},this.onCanvasPlay=async()=>{this.cleanupOverlays(),await this.drawOverlays(),this.frame.canvas.removeAttribute("hidden")},this.onDecode=(t,i,e)=>{if(i&&this.state.status===u.DETECTION_IN_PROGRESS){if(this.useLogs&&console.log("[psk-barcode-scanner] Scanned data:",i),this.modelHandler){if(n.play(),this.overlay&&this.overlay.drawOverlay(i.resultPoints),this.snapVideo&&function(t){const i=t.videoHeight,e=t.videoWidth,s=document.createElement("canvas");s.id="snapVideo",s.width=e,s.height=i;const n=s.getContext("2d");s.style.position="absolute",s.style.width="100%",s.style.height="100%",s.style.objectFit="cover",n.drawImage(t,0,0,e,i),t.parentElement.insertBefore(s,t)}(this.video),e.canvas){i.filter=e.canvas.id,i.frames=function(t){if("invertedSymbols"===t.id){const i=a("defaultInverted"),e=t.getContext("2d"),s=e.getImageData(0,0,t.width,t.height);i({imageData:s}),e.putImageData(s,0,0)}return{png:t.toDataURL("image/png"),jpg:t.toDataURL("image/jpeg")}}(e.canvas),i.source={width:this.frame.source.width,height:this.frame.source.height},i.videoSpecific={width:this.video.videoWidth,height:this.video.videoHeight},i.useWebWorker=this.useWebWorker;try{i.container=JSON.parse(JSON.stringify(this.container.getBoundingClientRect()))}catch(t){console.error("[psk-barcode-scanner] Could not log container dimensions!")}this.modelHandler.updateModel("results",i)}this.modelHandler.updateModel("data",i.text),this.snapVideo||this.cleanupOverlays()}return this.stopScanning(),void this.stopVideoStream()}"object"==typeof t&&"No MultiFormat Readers were able to detect the code."===t.message||console.error("[psk-barcode-scanner] Error while decoding",t)},this.decode=async(t,i)=>{if(this.state.status===u.DETECTION_DONE)return;c(this.frame.source,t,{points:this.frame.points,stopInternalCropping:this.stopInternalCropping});let e=t.getContext("2d").getImageData(0,0,t.width,t.height);if(this.useWebWorker)this.scanWorker.postMessage({message:"start decoding",imageData:e,filterId:i,sendImageData:this.useMetadata});else if(e=a(i)({imageData:e}),t.getContext("2d").putImageData(e,0,0),this.scanner)try{const e=this.scanner.decodeFromCanvas(t);e.filter={name:i,width:t.width,height:t.height},this.onDecode(void 0,e,{canvas:t})}catch(t){this.onDecode(t,void 0)}},this.scan=async()=>{await this.frame.scan()},this.createFilter=t=>{const i=function(t){const i=document.createElement("canvas"),e=i.getContext("2d");return i.width=t.width,i.height=t.height,e.drawImage(t,0,0),i}(this.frame.canvas);i.id=t,i.style.width="unset",i.style.height="unset",this.host.hasAttribute("dev-activate-internal-canvases")&&(i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.objectFit="unset",i.style.zIndex="1000",i.style.display="none",this.host.shadowRoot.append(i)),this.frame.addFilter({id:t,canvas:i,decode:()=>this.decode(i,t)})},this.createFilters=()=>{if(this.useWebWorker){const t=new Set;this.scanWorker.addEventListener("message",(async i=>{const{error:e,data:s,feedback:n}=i.data,{filterId:o,imageData:a}=n;let r=null;if(e&&s||n){if(this.useMetadata&&(r=this.frame.getFilter(o).canvas,r.getContext("2d").putImageData(a,0,0)),e)return this.useFrames?void this.onDecode(e,void 0):(t.add(o),void(t.size===this.frame.filterIds.length&&(t.clear(),await this.scan())));this.onDecode(void 0,s.result,{canvas:r})}else console.error("[psk-barcode-scanner] Wrong message format received from worker!")})),this.scanWorker.addEventListener("error",(t=>{console.error("[psk-barcode-scanner] scan-worker error",t)}))}this.createFilter("default"),this.createFilter("defaultInverted"),this.createFilter("otsuThresholding"),this.createFilter("otsuThresholdingInverted")},this.startVideoStream=async t=>{var i,e,s,n,o;let a=this.container.offsetWidth,r=this.container.offsetHeight;if((null===(s=null===(e=null===(i=window.WebCardinal)||void 0===i?void 0:i.state)||void 0===e?void 0:e.page)||void 0===s?void 0:s.loader)&&0===a){const t=window.WebCardinal.state.page.loader.parentElement,i=t.style.display;t.style.display="unset",a=this.container.offsetWidth,r=this.container.offsetHeight,(null===(o=null===(n=null===window||void 0===window?void 0:window.cardinal)||void 0===n?void 0:n.barcodeScanner)||void 0===o?void 0:o.dimensions)&&(window.cardinal.barcodeScanner.dimensions.width=a,window.cardinal.barcodeScanner.dimensions.height=r),t.style.display=i}const A={audio:!1,video:{facingMode:"environment",width:{ideal:3*a},height:{ideal:3*r}}};t&&"no-camera"!==t&&(delete A.video.facingMode,A.video.deviceId={exact:t});const d=this.video;try{const t=h("canvas",{id:"videoCanvas",width:a,height:r}),i=await navigator.mediaDevices.getUserMedia(A);await function(t,i){return new Promise((e=>{t.addEventListener("loadedmetadata",(()=>e()),!1),t.srcObject=i}))}(d,i);const e=c(d,t,{stopInternalCropping:this.stopInternalCropping});this.frame=new g(t,e),this.frame.source=d}catch(t){this.state.status=u.ACCESS_DENIED,console.error("[psk-barcode-scanner] Error while getting userMediaStream",t)}if(d.srcObject){try{const t=d.srcObject.getVideoTracks();for(let i=0;i<t.length;i++){const e=t[i];if("live"===e.readyState){this.activeDeviceId=e.getSettings().deviceId,"psk-scanner-device-id","localStorage"in window&&localStorage.setItem("psk-scanner-device-id",this.activeDeviceId);break}}}catch(t){console.error("[psk-barcode-scanner] Error while getting activeDeviceId",t)}this.createFilters(),await this.scan()}},this.stopVideoStream=()=>{if(!this.video)return;const t=this.video.srcObject;t&&(t.getTracks().forEach((t=>t.stop())),this.video.srcObject=null)},this.stopScanning=()=>{this.state.status=u.DETECTION_DONE,this.scanWorker&&(this.scanWorker.terminate(),this.scanWorker=void 0),this.frame&&(this.host.hasAttribute("dev-activate-internal-canvases")&&this.frame.filterIds.forEach((t=>{const i=this.host.shadowRoot.getElementById(t);i&&i.remove()})),delete this.frame)},window.addEventListener("resize",(async()=>{await A(),this.cleanupOverlays(),await this.drawOverlays()}))}async switchCamera(){const t=this.devices.map((t=>t.deviceId)),i=t.indexOf(this.activeDeviceId);return this.activeDeviceId=t[-1===i?0:(i+1)%t.length],this.stopScanning(),this.stopVideoStream(),this.state.status=u.CHANGE_CAMERA,this.activeDeviceId}async setFrame(t){if(!this.useFrames)return void console.error("[psk-barcode-scanner] Set useFrames accordingly in order to use setFrame");this.host&&this.host.shadowRoot||await this.host.componentOnReady();const i=await async function(t){return new Promise((i=>{const e=new Image;e.addEventListener("load",(()=>i(e))),e.src=t}))}(t);if(!this.frame.canvas){const t=this.host.shadowRoot.querySelector("#frame"),e=c(i,t,{stopInternalCropping:this.stopInternalCropping});return this.frame=new g(t,e),this.frame.source=i,await this.onCanvasPlay(),await this.createFilters(),void await this.scan()}this.frame.source=i,c(this.frame.source,this.frame.canvas,{stopInternalCropping:this.stopInternalCropping}),await this.scan()}async componentWillLoad(){if(!this.host.isConnected)return;this.state.status=u.LOADING_CAMERAS;try{this.devices=await async function(){if(!window.navigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!window.navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const t=await navigator.mediaDevices.enumerateDevices(),i=[];for(const e of t){const{kind:t}=e;"videoinput"===t&&i.push({deviceId:e.deviceId,label:e.label||"Video device "+(i.length+1),kind:t,groupId:e.groupId})}return i}()}catch(t){console.error("[psk-barcode-scanner] Error while getting video devices",t)}if(this.host.hasAttribute("results")&&(this.useMetadata=!0),this.useFrames)return void(this.state.status=u.DETECTION_STARTED);if(0===this.devices.length)return void(this.state.status=u.NO_DETECTION);const t=function(){if("localStorage"in window)return localStorage.getItem("psk-scanner-device-id")}();if(t){const i=this.devices.find((i=>i.deviceId===t));i?this.activeDeviceId=i.deviceId:"localStorage"in window&&localStorage.removeItem("psk-scanner-device-id")}this.state.status=u.DETECTION_STARTED}async componentDidRender(){switch(this.state.status){case u.DETECTION_STARTED:case u.CHANGE_CAMERA:this.state.status=u.DETECTION_IN_PROGRESS,this.initializeReferencesToElements(),this.attachOnClickForChangeCamera(),await this.initializeScanningMethod(),await(t=this.video,50,new Promise((i=>{if(r(t))return void i();const e=setInterval((()=>{if(r(t))return i(),void clearInterval(e)}),50)}))),await A(),this.useFrames||await this.startVideoStream(this.activeDeviceId)}var t}async disconnectedCallback(){this.stopScanning(),this.stopVideoStream()}render(){return[i("style",null,d()),this.useWebWorker?null:i("script",{async:!0,src:"webcardinal/extended/cardinal-barcode/worker/zxing-browser.min.js",onLoad:this.onZXingBrowserLoad}),i("div",{part:"base",style:l.base},i("div",{id:"container",part:"container",style:l.container},i("input",{type:"file",accept:"video/*",capture:"environment",style:l.input}),i("video",{id:"video",part:"video",onPlay:this.onVideoPlay,autoplay:!0,playsinline:!0,hidden:!0,style:l.video}),i("canvas",{id:"frame",part:"frame",hidden:!0,style:l.video}),i("div",{id:"content",part:"content",innerHTML:this.renderContent()})))]}get host(){return e(this)}};!function(t,i,e,s){var n,o=arguments.length,a=o<3?i:null===s?s=Object.getOwnPropertyDescriptor(i,e):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,i,e,s);else for(var r=t.length-1;r>=0;r--)(n=t[r])&&(a=(o<3?n(a):o>3?n(i,e,a):n(i,e))||a);o>3&&a&&Object.defineProperty(i,e,a)}([s()],m.prototype,"modelHandler",void 0);export{m as psk_barcode_scanner}